<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:WixUI="http://schemas.microsoft.com/wix/WixUIExtension"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">

  <Product
    Id="*"
    Name="Fortuna Faucet - Racing Analysis Engine"
    Language="1033"
    Version="$(var.Version)"
    Manufacturer="Mason J0 Studios"
    UpgradeCode="12345678-1234-1234-1234-123456789012">

    <Package
      InstallerVersion="200"
      Compressed="yes"
      InstallScope="perMachine"
      Platform="x64"
      Description="Horse racing analysis platform with Python backend and React frontend"
      Comments="Professional-grade installer"/>

    <Media Id="1" Cabinet="fortuna.cab" EmbedCab="yes"/>

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

    <!-- Directory Structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLFOLDER" Name="Fortuna Faucet"/>
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="Fortuna Faucet"/>
      </Directory>
    </Directory>

    <!-- Features (What users can select) -->
    <Feature Id="ProductFeature" Title="Fortuna Faucet" Level="1">
        <ComponentGroupRef Id="ProductComponents"/>
        <ComponentGroupRef Id="ShortcutsComponentGroup"/>
        <ComponentGroupRef Id="BackendFileGroup"/>
        <ComponentGroupRef Id="FrontendFileGroup"/>
    </Feature>

    <!-- Components (Logical file groupings) -->
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <Component Id="RegistryAndServiceComponent" Guid="F25A1181-9943-4753-9095-585A826B6D21">
        <RegistryValue Root="HKLM" Key="Software\Fortuna Faucet\Backend" Name="Installed" Type="integer" Value="1" />
        <RegistryValue Root="HKLM" Key="Software\Fortuna Faucet\Frontend" Name="Installed" Type="integer" Value="1" />
        <RegistryValue Root="HKLM" Key="Software\Fortuna Faucet" Name="Installed" Type="integer" Value="1" KeyPath="yes"/>
        <ServiceInstall Id="FortunaService" Name="FortunaFaucetBackend" DisplayName="Fortuna Faucet Background Service" Description="Continuous horse racing data monitoring engine" Type="ownProcess" Start="auto" Account="LocalSystem" ErrorControl="normal"/>
        <ServiceControl Id="StartService" Name="FortunaFaucetBackend" Start="install" Stop="both" Remove="uninstall"/>
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="ShortcutsComponentGroup" Directory="ApplicationProgramsFolder">
      <Component Id="DesktopShortcutsComponent" Guid="*">
          <util:InternetShortcut Id="DashboardShortcut" Name="Fortuna Faucet Dashboard" Target="http://localhost:3000"/>
          <Shortcut Id="UninstallShortcut" Name="Uninstall Fortuna Faucet" Description="Remove this application" Target="[SystemFolder]msiexec.exe" Arguments="/x [ProductCode]" Advertise="no"/>
          <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
          <RegistryValue Root="HKCU" Key="Software\Fortuna Faucet" Name="Installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </ComponentGroup>


    <!-- UI Customization -->
    <UI>
      <UIRef Id="WixUI_InstallDir" />
    </UI>
    <WixVariable Id="WixUILicenseRtf" Value="electron\assets\license.rtf"/>
    <!-- The following two variables are for custom UI images. -->
    <!-- To enable them, create the files and uncomment the lines. -->
    <!-- <WixVariable Id="WixUIBannerBmp" Value="electron\assets\banner.bmp"/> -->
    <!-- <WixVariable Id="WixUIDialogBmp" Value="electron\assets\dialog.bmp"/> -->

    <!-- System Requirements -->
    <Condition Message="Windows 7 or later (64-bit) is required">
      <![CDATA[Installed OR (VersionNT64 >= 601)]]>
    </Condition>


  </Product>
</Wix>
