"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[19],{6019:function(e,t,s){s.r(t),s.d(t,{LiveRaceDashboard:function(){return S}});var a=s(7437),r=s(2265),l=s(9827),n=s(1713),d=s(8728),i=s(9076);let c={maxFieldSize:10,minFavoriteOdds:2.5,minSecondFavoriteOdds:4};function o(e){let{onParamsChange:t,isLoading:s}=e,[l,n]=(0,r.useState)(c),[o,x]=(0,r.useState)(!1),m=(0,r.useCallback)((e,s)=>{n(a=>{let r={...a,[e]:s};return t(r),r})},[t]),u=(0,r.useCallback)(()=>{n(c),t(c)},[t]);return(0,a.jsxs)("div",{className:"bg-gradient-to-r from-slate-800 to-slate-900 rounded-lg p-4 mb-6 border border-slate-700",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"w-5 h-5 text-amber-500"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Race Filters"})]}),(0,a.jsx)("button",{onClick:()=>x(!o),className:"text-sm text-slate-400 hover:text-slate-200 transition",children:o?"Hide":"Show"})]}),o&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 pt-4 border-t border-slate-700",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-slate-300",children:["Max Field Size",(0,a.jsx)("span",{className:"text-amber-500 ml-2",children:l.maxFieldSize})]}),(0,a.jsx)("input",{type:"range",min:"2",max:"20",value:l.maxFieldSize,onChange:e=>m("maxFieldSize",parseInt(e.target.value)),disabled:s,className:"w-full accent-amber-500 cursor-pointer disabled:opacity-50"}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:"Filters races with larger fields"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-slate-300",children:["Min Favorite Odds",(0,a.jsx)("span",{className:"text-amber-500 ml-2",children:l.minFavoriteOdds.toFixed(2)})]}),(0,a.jsx)("input",{type:"range",min:"1.5",max:"5",step:"0.1",value:l.minFavoriteOdds,onChange:e=>m("minFavoriteOdds",parseFloat(e.target.value)),disabled:s,className:"w-full accent-amber-500 cursor-pointer disabled:opacity-50"}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:"Higher = pickier favorites"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-slate-300",children:["Min 2nd Favorite Odds",(0,a.jsx)("span",{className:"text-amber-500 ml-2",children:l.minSecondFavoriteOdds.toFixed(2)})]}),(0,a.jsx)("input",{type:"range",min:"2.0",max:"8",step:"0.1",value:l.minSecondFavoriteOdds,onChange:e=>m("minSecondFavoriteOdds",parseFloat(e.target.value)),disabled:s,className:"w-full accent-amber-500 cursor-pointer disabled:opacity-50"}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:"Higher = better odds separation"})]}),(0,a.jsx)("div",{className:"md:col-span-3 flex justify-end pt-4 border-t border-slate-700",children:(0,a.jsxs)("button",{onClick:u,disabled:s,className:"inline-flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded text-sm font-medium transition disabled:opacity-50",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),"Reset to Defaults"]})})]})]})}let x=e=>{let{startTime:t}=e,[s,l]=(0,r.useState)(new Date);(0,r.useEffect)(()=>{let e=setInterval(()=>l(new Date),1e3);return()=>clearInterval(e)},[]);let n=(e=>{let t=new Date(e).getTime()-s.getTime();if(t<=0)return{text:"RACE COMPLETE",color:"text-gray-500"};let a=Math.floor(t/6e4),r=Math.floor(t%6e4/1e3).toString().padStart(2,"0"),l="text-green-400";return a<2?l="text-red-500 font-bold animate-pulse":a<10&&(l="text-yellow-400"),{text:"".concat(a,":").concat(r," to post"),color:l}})(t);return(0,a.jsx)("span",{className:"font-mono text-sm ".concat(n.color),children:n.text})},m=e=>{let{race:t}=e,s=t.runners.filter(e=>!e.scratched);s.sort((e,t)=>e.number-t.number);let r=e=>{if(!e.odds)return null;let t=Object.values(e.odds).filter(e=>null!==e.win&&void 0!==e.win&&e.win<999);if(0===t.length)return null;let s=t.reduce((e,t)=>{var s,a;return(null!==(s=t.win)&&void 0!==s?s:999)<(null!==(a=e.win)&&void 0!==a?a:999)?t:e});return{odds:s.win,source:s.source}};return(0,a.jsxs)("div",{className:"race-card-enhanced border rounded-lg p-4 bg-gray-800 shadow-lg hover:border-purple-500 transition-all ".concat(t.qualification_score&&t.qualification_score>=80?"card-premium":"border-gray-700"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white",children:t.venue}),(0,a.jsxs)("div",{className:"flex gap-2 text-sm text-gray-400",children:[(0,a.jsxs)("span",{children:["Race ",t.race_number]}),(0,a.jsx)("span",{children:"â€¢"}),(0,a.jsx)(x,{startTime:t.start_time})]}),t.favorite&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-sm text-yellow-400",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),(0,a.jsxs)("span",{className:"font-semibold",children:["Favorite: ",t.favorite.name]})]})]})}),t.qualification_score&&(0,a.jsxs)("div",{className:"px-4 py-2 rounded-full text-center ".concat(t.qualification_score>=80?"bg-red-500/20 text-red-400 border border-red-500/30":t.qualification_score>=60?"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30":"bg-green-500/20 text-green-400 border border-green-500/30"),children:[(0,a.jsxs)("div",{className:"font-bold text-lg",children:[t.qualification_score.toFixed(0),"%"]}),(0,a.jsx)("div",{className:"text-xs",children:"Score"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2 mb-4 p-3 bg-gray-800/50 rounded-lg",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Distance"}),(0,a.jsx)("div",{className:"text-sm font-semibold text-white",children:t.distance||"N/A"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Surface"}),(0,a.jsx)("div",{className:"text-sm font-semibold text-white",children:t.surface||"Dirt"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Field"}),(0,a.jsx)("div",{className:"text-sm font-semibold text-white",children:s.length})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Sources"}),(0,a.jsx)("div",{className:"text-sm font-semibold text-white",children:(e=>{let t=new Set;return e.forEach(e=>{e.odds&&Object.keys(e.odds).forEach(e=>t.add(e))}),t.size})(t.runners)})]})]}),(0,a.jsx)("div",{className:"runners-table space-y-2",children:s.map((e,t)=>{let s=r(e);return(0,a.jsx)("div",{className:"runner-row group hover:bg-purple-500/10 transition-all rounded-md p-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all group-hover:scale-110 text-gray-900 shadow-lg ".concat(0===t?"bg-gradient-to-br from-yellow-400 to-yellow-600 shadow-yellow-500/50":1===t?"bg-gradient-to-br from-gray-300 to-gray-500 shadow-gray-400/50":2===t?"bg-gradient-to-br from-orange-400 to-orange-600 shadow-orange-500/50":"bg-gray-700 text-gray-300"),children:e.number}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-bold text-white text-lg",children:e.name}),(0,a.jsxs)("div",{className:"flex gap-3 text-sm text-gray-400",children:[e.jockey&&(0,a.jsxs)("span",{children:["J: ",e.jockey]}),e.trainer&&(0,a.jsxs)("span",{children:["T: ",e.trainer]})]})]})]}),s&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-emerald-400",children:s.odds.toFixed(2)}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["via ",s.source]})]})]})},e.number)})})]})},u=()=>(0,a.jsxs)("div",{className:"race-card-skeleton border border-gray-700 rounded-lg p-4 bg-gray-800 shadow-lg animate-pulse",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"h-7 w-28 bg-gray-700 rounded-md"}),(0,a.jsx)("div",{className:"h-4 w-40 bg-gray-700 rounded-md mt-2"})]})}),(0,a.jsx)("div",{className:"h-16 w-16 bg-gray-700 rounded-full"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2 mb-4 p-3 bg-gray-800/50 rounded-lg",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"h-3 w-12 mx-auto bg-gray-700 rounded-md"}),(0,a.jsx)("div",{className:"h-4 w-8 mx-auto bg-gray-700 rounded-md mt-2"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"h-3 w-12 mx-auto bg-gray-700 rounded-md"}),(0,a.jsx)("div",{className:"h-4 w-8 mx-auto bg-gray-700 rounded-md mt-2"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"h-3 w-10 mx-auto bg-gray-700 rounded-md"}),(0,a.jsx)("div",{className:"h-4 w-6 mx-auto bg-gray-700 rounded-md mt-2"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"h-3 w-10 mx-auto bg-gray-700 rounded-md"}),(0,a.jsx)("div",{className:"h-4 w-6 mx-auto bg-gray-700 rounded-md mt-2"})]})]}),(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsx)("div",{className:"runner-row rounded-md p-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-700"}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)("div",{className:"h-5 w-32 bg-gray-700 rounded-md"}),(0,a.jsx)("div",{className:"h-4 w-40 bg-gray-700 rounded-md"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"h-6 w-16 bg-gray-700 rounded-md"}),(0,a.jsx)("div",{className:"h-3 w-12 bg-gray-700 rounded-md mt-2"})]})]})},t))})]}),h=e=>{let{title:t,message:s,actionButton:r}=e;return(0,a.jsxs)("div",{className:"text-center p-8 bg-gray-800/50 border border-gray-700 rounded-lg mt-8",children:[(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,a.jsx)("path",{vectorEffect:"non-scaling-stroke",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("h3",{className:"mt-2 text-xl font-semibold text-white",children:t}),(0,a.jsx)("p",{className:"mt-1 text-md text-gray-400",children:s}),r&&(0,a.jsx)("div",{className:"mt-6",children:r})]})},g=e=>{let{error:t}=e;return(0,a.jsxs)("div",{className:"bg-red-900/20 border border-red-500/30 text-white rounded-lg p-6 max-w-2xl mx-auto my-8",children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-red-400 mr-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-red-400",children:"An Error Occurred"})]}),(0,a.jsx)("p",{className:"text-lg text-slate-300 mb-2",children:t.message}),(0,a.jsx)("p",{className:"text-slate-400 mb-6",children:t.suggestion}),t.details&&(0,a.jsxs)("details",{className:"bg-slate-800/50 rounded-lg p-4",children:[(0,a.jsx)("summary",{className:"cursor-pointer text-sm text-slate-500 hover:text-white",children:"Technical Details"}),(0,a.jsx)("pre",{className:"text-xs text-slate-400 mt-2 p-2 bg-black/30 rounded overflow-x-auto",children:(0,a.jsx)("code",{children:t.details})})]})]})},b=(e,t)=>{let[s,a]=(0,r.useState)(null),[l,n]=(0,r.useState)(!1),d=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!e||!t.apiKey){d.current&&d.current.close();return}let s=new URL(e,window.location.href);s.protocol=s.protocol.replace("http","ws"),s.searchParams.append("api_key",t.apiKey);let r=new WebSocket(s.toString());return d.current=r,r.onopen=()=>{console.log("WebSocket connection established."),n(!0)},r.onmessage=e=>{try{let t=JSON.parse(e.data);a(t)}catch(e){console.error("Error parsing WebSocket message:",e)}},r.onerror=e=>{console.error("WebSocket error:",e)},r.onclose=e=>{console.log("WebSocket connection closed: ".concat(e.code," ").concat(e.reason)),n(!1),d.current=null},()=>{r.readyState===WebSocket.OPEN&&r.close()}},[e,t.apiKey]),{data:s,isConnected:l}},p=e=>{let{isOpen:t,onClose:s,status:r}=e;if(!t)return null;let{title:l,details:n}=r,d="string"==typeof n,i=d||"SUCCESS"!==n.status&&"OK"!==n.status?"text-gray-300":"text-green-400";return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",onClick:s,children:(0,a.jsxs)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-xl p-6 max-w-lg w-full",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-white",children:l}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-white",children:"\xd7"})]}),(0,a.jsx)("div",{className:"space-y-2 text-sm max-h-96 overflow-y-auto pr-2",children:d?(0,a.jsx)("div",{className:"text-gray-300 whitespace-pre-wrap bg-gray-900/50 p-4 rounded-md",children:n}):Object.entries(n).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 border-b border-gray-700/50 py-2",children:[(0,a.jsx)("span",{className:"font-semibold text-gray-400 capitalize",children:t.replace(/_/g," ")}),(0,a.jsx)("span",{className:"col-span-2 break-words ".concat("status"===t?i:"text-gray-300"),children:"object"==typeof s?JSON.stringify(s,null,2):String(s)})]},t)})}),(0,a.jsx)("button",{onClick:s,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded w-full mt-6",children:"Close"})]})})};var j=e=>{let{adapterName:t,attemptedUrl:s}=e,[l,n]=(0,r.useState)(!0);return l?(0,a.jsxs)("div",{className:"bg-red-900 bg-opacity-50 border border-red-700 p-4 rounded-lg shadow-lg mb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-bold text-red-300",children:["Data Fetch Failed: ",t]}),(0,a.jsxs)("p",{className:"text-sm text-red-400",children:["The application failed to automatically retrieve data from:"," ",(0,a.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-red-200",children:s})]})]}),(0,a.jsx)("button",{onClick:()=>n(!1),className:"text-red-400 hover:text-red-200 text-2xl",children:"\xd7"})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("p",{className:"text-sm text-red-300 mb-2",children:[(0,a.jsx)("strong",{children:"To resolve this:"}),(0,a.jsxs)("ol",{className:"list-decimal list-inside pl-4",children:[(0,a.jsx)("li",{children:"Click the link above to open the page in a new tab."}),(0,a.jsx)("li",{children:'Right-click on the page and select "View Page Source".'}),(0,a.jsx)("li",{children:"Copy the entire HTML source code."}),(0,a.jsx)("li",{children:'Paste the code into the text area below and click "Submit Manual Data".'})]})]}),(0,a.jsx)("textarea",{className:"w-full h-24 p-2 bg-gray-900 border border-gray-700 rounded text-gray-300 font-mono text-xs",placeholder:"Paste HTML source for ".concat(t," here...")}),(0,a.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:"Submit Manual Data"}),(0,a.jsx)("button",{onClick:()=>n(!1),className:"px-3 py-1.5 bg-gray-700 text-white rounded hover:bg-gray-600 text-sm",children:"Skip for Now"})]})]})]}):null},v=s(257);let f=async e=>{if(!e)throw Error("API key not configured or retrieved.");let t=await fetch("/api/adapters/status",{headers:{"X-API-Key":e,"Content-Type":"application/json"}});if(!t.ok)throw Error(JSON.stringify(await t.json()));return t.json()},N=e=>{let{logs:t,onRestart:s}=e;return(0,a.jsxs)("div",{className:"bg-slate-800 p-6 rounded-lg border border-red-500/50 text-white",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:"Backend Service Error"}),(0,a.jsx)("p",{className:"text-slate-400 mb-4",children:"The backend data service failed to start or has crashed. Below are the most recent diagnostic messages."}),(0,a.jsx)("div",{className:"bg-black p-4 rounded-md font-mono text-sm text-slate-300 h-64 overflow-y-auto mb-4",children:t.map((e,t)=>(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:"> ".concat(e)},t))}),(0,a.jsx)("button",{onClick:s,className:"w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Restart Backend Service"})]})},w=e=>{let{source:t,message:s}=e;return(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 border border-red-500/50 flex flex-col justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-bold text-red-400 text-lg",children:[t," Failed"]}),(0,a.jsx)("p",{className:"text-slate-400 text-sm mt-2",children:s})]}),(0,a.jsx)("div",{className:"mt-4 text-xs text-slate-500",children:(0,a.jsx)("p",{children:"This adapter failed to fetch data. This is not a critical error; other adapters may provide the necessary data."})})]})},y=e=>{let{races:t}=e;return(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:t.map(e=>e.isErrorPlaceholder?(0,a.jsx)(w,{source:e.venue,message:e.errorMessage||"An unknown error occurred."},e.id):(0,a.jsx)(m,{race:e},e.id))})},k=()=>{let[e,t]=(0,r.useState)({state:"starting",logs:[]});return(0,r.useEffect)(()=>{var e;let s=!0,a=async()=>{var e;if(null===(e=window.electronAPI)||void 0===e?void 0:e.getBackendStatus)try{let e=await window.electronAPI.getBackendStatus();s&&t(e)}catch(e){console.error("Failed to get initial backend status:",e),s&&t({state:"error",logs:["Failed to query backend status from main process."]})}else t({state:"running",logs:["In a web-only environment, backend is assumed to be running."]})};if(null===(e=window.electronAPI)||void 0===e?void 0:e.onBackendStatusUpdate){let e=window.electronAPI.onBackendStatusUpdate(e=>{s&&t(e)});return a(),()=>{s=!1,"function"==typeof e&&e()}}a()},[]),e},S=r.memo(()=>{let[e,t]=(0,r.useState)([]),[s,d]=(0,r.useState)([]),i=k(),[c,x]=(0,r.useState)(null),m=(0,l.NL)();(0,r.useEffect)(()=>{(async()=>{try{let e=window.electronAPI?await window.electronAPI.getApiKey():v.env.NEXT_PUBLIC_API_KEY;e?x(e):console.error("API key could not be retrieved.")}catch(e){console.error("Error fetching API key:",e)}})()},[]);let{data:w,status:S,error:C,refetch:F}=(0,n.a)({queryKey:["adapterStatuses",c],queryFn:()=>f(c),enabled:"running"===i.state&&!!c,refetchOnWindowFocus:!1}),{data:E,isConnected:P}=b(c?"/ws/live-updates":"",{apiKey:c});(0,r.useEffect)(()=>{if(E){var e;console.log("Received live data update:",E),m.setQueryData(["adapterStatuses",c],E.source_info),t(E.races||[]),d((null===(e=E.source_info)||void 0===e?void 0:e.filter(e=>"FAILED"===e.status&&e.attemptedUrl))||[]),A(new Date)}},[E,m,c]);let[O,A]=(0,r.useState)(null),[I,_]=(0,r.useState)({maxFieldSize:10,minFavoriteOdds:2.5,minSecondFavoriteOdds:4}),[B,T]=(0,r.useState)(!1),D=(0,r.useCallback)(e=>{_(e)},[]),{color:L,text:R}="error"===i.state?{color:"bg-red-500",text:"Backend Error"}:"stopped"===i.state?{color:"bg-gray-500",text:"Stopped"}:"starting"===i.state?{color:"bg-yellow-500",text:"Backend Starting..."}:P?{color:"bg-cyan-500",text:"Live"}:{color:"bg-yellow-500",text:"Connecting..."};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"text-left space-y-2",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-white",children:"\uD83C\uDFC7 Fortuna Faucet"}),(0,a.jsxs)("p",{className:"text-slate-400",children:["Last updated: ",O?O.toLocaleTimeString():"N/A"]})]}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsxs)("button",{onClick:()=>("error"===S||"error"===i.state)&&T(!0),className:"flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium text-white ".concat(L," ").concat("error"===S||"error"===i.state?"cursor-pointer hover:opacity-80":"cursor-default"),"data-testid":"status-indicator",children:[(0,a.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-white ".concat(P?"animate-pulse":"")}),R]})})]}),(0,a.jsx)(o,{onParamsChange:D,isLoading:"pending"===S}),s.map(e=>(0,a.jsx)(j,{adapterName:e.name,attemptedUrl:e.attemptedUrl||"URL not available"},e.name)),(()=>{if("error"===i.state)return(0,a.jsx)(N,{logs:i.logs,onRestart:()=>window.electronAPI.restartBackend()});if("stopped"===i.state)return(0,a.jsx)(h,{title:"Backend Service Stopped",message:"The backend data service is not running. Please start it to see live race data.",actionButton:(0,a.jsx)("button",{onClick:()=>window.electronAPI.restartBackend(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Start Backend Service"})});if("starting"===i.state||"pending"===S&&!w)return(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((e,t)=>(0,a.jsx)(u,{},t))});if("error"===S)try{let e=JSON.parse(C.message);return(0,a.jsx)(g,{error:e.error})}catch(e){return(0,a.jsx)(h,{title:"API Connection Offline",message:(null==C?void 0:C.message)||"The backend is running, but the dashboard could not connect to its API.",actionButton:(0,a.jsx)("button",{onClick:()=>F(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry Connection"})})}return e&&0!==e.length?(0,a.jsx)(y,{races:e}):(0,a.jsx)(h,{title:"No Races Found",message:"No races matched the specified criteria for the selected date. Please try different filters."})})()]}),(0,a.jsx)(p,{isOpen:B,onClose:()=>T(!1),status:{title:"Connection Error",details:(null==C?void 0:C.message)||"No specific error message was provided."}})]})})}}]);