<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:util="http://wixtoolset.org/schemas/v4/wxs/util">

    <Package Name="Fortuna Faucet (Service)" Language="1033" Version="1.0.0.0"
             Manufacturer="Fortuna Development" UpgradeCode="{A1B2C3D4-E5F6-7890-1234-567890ABCDEF}"
             InstallerVersion="200" Compressed="yes">

        <MajorUpgrade DowngradeErrorMessage="A newer version is already installed." />
        <MediaTemplate EmbedCab="yes" />

        <Feature Id="ProductFeature" Title="Fortuna Faucet Service" Level="1">
            <ComponentRef Id="cmp_fortuna_backend" />
            <ComponentGroupRef Id="FrontendFiles" />
            <ComponentRef Id="ApplicationShortcuts" />
        </Feature>

        <StandardDirectory Id="ProgramFilesFolder">
            <Directory Id="INSTALLFOLDER" Name="Fortuna Faucet Service">
                <Component Id="cmp_fortuna_backend" Guid="*">
                    <File Id="file_fortuna_backend_exe" KeyPath="yes" Source="$(var.SourceDir)\fortuna-backend.exe" />
                    <ServiceInstall
                        Id="ServiceInstaller"
                        Name="FortunaBackendService"
                        DisplayName="Fortuna Faucet Backend Service"
                        Description="Fortuna Faucet Backend API Service"
                        Type="ownProcess"
                        Start="auto"
                        ErrorControl="normal"
                        Account="NetworkService"
                        Interactive="no"
                    >
                        <util:ServiceConfig
                            FirstFailureActionType="restart"
                            SecondFailureActionType="restart"
                            ThirdFailureActionType="restart"
                            ResetPeriodInDays="1"
                            RestartServiceDelayInSeconds="60" />
                    </ServiceInstall>
                    <ServiceControl
                        Id="ServiceStarter"
                        Start="install"
                        Stop="both"
                        Remove="uninstall"
                        Name="FortunaBackendService"
                        Wait="yes"
                    />
                </Component>
                <Directory Id="UIDirectory" Name="ui" />
            </Directory>
        </StandardDirectory>

        <StandardDirectory Id="ProgramMenuFolder">
            <Directory Id="ApplicationProgramsFolder" Name="Fortuna Faucet"/>
        </StandardDirectory>

        <DirectoryRef Id="ApplicationProgramsFolder">
            <Component Id="ApplicationShortcuts" Guid="*">
                <Shortcut Id="ApplicationStartMenuShortcut"
                          Name="Fortuna Faucet Dashboard"
                          Description="Launch the Fortuna Faucet Dashboard"
                          Target="[INSTALLFOLDER]ui\index.html"
                          WorkingDirectory="INSTALLFOLDER"/>
                <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
                <RegistryValue Root="HKCU" Key="Software\Fortuna\Service" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
        </DirectoryRef>

        <ComponentGroup Id="FrontendFiles" Directory="UIDirectory" />

    </Package>
</Wix>
