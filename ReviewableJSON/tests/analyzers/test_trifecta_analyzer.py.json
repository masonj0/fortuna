{
    "file_path": "tests/analyzers/test_trifecta_analyzer.py",
    "content": "# Dedicated test suite for the TrifectaAnalyzer, resurrected and expanded.\nfrom datetime import datetime\n\nimport pytest\n\nfrom python_service.analyzer import TrifectaAnalyzer\nfrom python_service.models import Race\nfrom python_service.models import Runner\n\n\n@pytest.fixture\ndef analyzer():\n    return TrifectaAnalyzer()\n\n\n@pytest.fixture\ndef runners():\n    return []\n\n\n@pytest.fixture\ndef create_race(runners):\n    return Race(\n        id=\"test-race\",\n        venue=\"TEST\",\n        race_number=1,\n        start_time=datetime.now(),\n        runners=runners,\n        source=\"test\",\n    )\n\n\ndef test_analyzer_name(analyzer):\n    assert analyzer.name == \"trifecta_analyzer\"\n\n\n# Test cases resurrected from legacy scorer and logic tests\ndef test_qualifies_with_exactly_three_runners(analyzer, create_race):\n    from decimal import Decimal\n\n    from python_service.models import OddsData\n\n    odds1 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"3.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    odds2 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"4.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    odds3 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"5.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    create_race.runners = [\n        Runner(number=1, name=\"A\", odds=odds1, scratched=False),\n        Runner(number=2, name=\"B\", odds=odds2, scratched=False),\n        Runner(number=3, name=\"C\", odds=odds3, scratched=False),\n    ]\n    assert analyzer.is_race_qualified(create_race) is True\n\n\ndef test_qualifies_with_more_than_three_runners(analyzer, create_race):\n    from decimal import Decimal\n\n    from python_service.models import OddsData\n\n    odds1 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"3.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    odds2 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"4.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    odds3 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"5.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    odds4 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"6.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    create_race.runners = [\n        Runner(number=1, name=\"A\", odds=odds1, scratched=False),\n        Runner(number=2, name=\"B\", odds=odds2, scratched=False),\n        Runner(number=3, name=\"C\", odds=odds3, scratched=False),\n        Runner(number=4, name=\"D\", odds=odds4, scratched=False),\n    ]\n    assert analyzer.is_race_qualified(create_race) is True\n\n\n# New test cases for edge-case hardening\ndef test_rejects_with_fewer_than_three_runners(analyzer, create_race):\n    from decimal import Decimal\n\n    from python_service.models import OddsData\n\n    odds1 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"3.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    odds2 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"4.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    create_race.runners = [\n        Runner(number=1, name=\"A\", odds=odds1, scratched=False),\n        Runner(number=2, name=\"B\", odds=odds2, scratched=False),\n    ]\n    assert analyzer.is_race_qualified(create_race) is False\n\n\ndef test_rejects_if_scratched_runners_reduce_field_below_three(analyzer, create_race):\n    from decimal import Decimal\n\n    from python_service.models import OddsData\n\n    odds1 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"3.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    odds2 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"4.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    odds3 = {\n        \"TestOdds\": OddsData(\n            win=Decimal(\"5.0\"), source=\"TestOdds\", last_updated=datetime.now()\n        )\n    }\n    create_race.runners = [\n        Runner(number=1, name=\"A\", odds=odds1, scratched=False),\n        Runner(number=2, name=\"B\", odds=odds2, scratched=False),\n        Runner(number=3, name=\"C\", odds=odds3, scratched=True),  # Scratched\n    ]\n    assert analyzer.is_race_qualified(create_race) is False\n\n\ndef test_handles_empty_runner_list(analyzer, create_race):\n    race = create_race\n    race.runners = []\n    assert analyzer.is_race_qualified(race) is False\n\n\ndef test_handles_none_race_object(analyzer):\n    assert analyzer.is_race_qualified(None) is False\n"
}