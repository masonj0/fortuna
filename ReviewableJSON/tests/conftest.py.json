{
    "file_path": "tests/conftest.py",
    "content": "# tests/conftest.py\nfrom unittest.mock import Mock\nfrom unittest.mock import patch\n\nimport httpx\nimport pytest\nfrom fastapi.testclient import TestClient\n\nfrom python_service.api import app\nfrom python_service.api import get_settings\nfrom python_service.config import Settings\n\n\ndef get_test_settings():\n    \"\"\"\n    Returns a comprehensive, test-specific Settings object that satisfies all\n    adapter configuration requirements. This prevents AdapterConfigErrors during\n    app startup in a test environment.\n    \"\"\"\n    return Settings(\n        API_KEY=\"a_secure_test_api_key_that_is_long_enough\",\n        # Required by TheRacingApiAdapter\n        THE_RACING_API_KEY=\"test_racing_api_key\",\n        # Required by Betfair adapters\n        BETFAIR_APP_KEY=\"test_betfair_key\",\n        # Required by TVGAdapter\n        TVG_API_KEY=\"test_tvg_key\",\n        # Required by RacingAndSports adapters\n        RACING_AND_SPORTS_TOKEN=\"test_ras_token\",\n        # Required by GreyhoundAdapter\n        GREYHOUND_API_URL=\"https://api.example.com/greyhound\",\n    )\n\n\n@pytest.fixture(scope=\"module\")\ndef client():\n    \"\"\"\n    A TestClient instance for testing the FastAPI app.\n    This fixture handles the setup and teardown of dependency overrides.\n    \"\"\"\n    original_get_settings = app.dependency_overrides.get(get_settings)\n    app.dependency_overrides[get_settings] = get_test_settings\n\n    with patch(\n        \"python_service.credentials_manager.keyring.get_password\",\n        side_effect=lambda s, u: f\"test_{u}\",\n    ):\n        with TestClient(app) as c:\n            yield c\n\n    # Clean up the override\n    if original_get_settings:\n        app.dependency_overrides[get_settings] = original_get_settings\n    else:\n        app.dependency_overrides.clear()\n\n\n@pytest.fixture\ndef mock_httpx_client():\n    \"\"\"Mocks the httpx.AsyncClient for testing adapters.\"\"\"\n    return Mock(spec=httpx.AsyncClient)\n"
}