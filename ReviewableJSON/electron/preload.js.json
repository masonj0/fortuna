{
    "file_path": "electron/preload.js",
    "content": "// electron/preload.js\n// This script runs in a privileged environment with access to Node.js APIs.\n// It's used to securely expose specific functionality to the renderer process (the web UI).\n\nconst { contextBridge, ipcRenderer } = require('electron');\n\n// Expose a safe, limited API to the frontend.\ncontextBridge.exposeInMainWorld('electronAPI', {\n  /**\n   * Asynchronously fetches the secure API key from the main process.\n   * @returns {Promise<string|null>} A promise that resolves with the API key or null if not found.\n   */\n  getApiKey: () => ipcRenderer.invoke('get-api-key'),\n\n  /**\n   * Registers a callback to be invoked when the backend status changes.\n   * @param {Function} callback - The function to call with the status object.\n   *                              It receives an object like { status: 'online' | 'offline', error?: string }.\n   */\n  onBackendStatusUpdate: (callback) => {\n    const handler = (_event, value) => callback(value);\n    ipcRenderer.on('backend-status-update', handler);\n    // Return a cleanup function to remove the listener\n    return () => ipcRenderer.removeListener('backend-status-update', handler);\n  },\n  restartBackend: () => ipcRenderer.send('restart-backend'),\n  getBackendStatus: () => ipcRenderer.invoke('get-backend-status'),\n  generateApiKey: () => ipcRenderer.invoke('generate-api-key'),\n});\n\nconsole.log('Preload script loaded and electronAPI is exposed.');\n"
}